{"version":3,"sources":["../../../../src/components/declarative-ui/xviz-table.js"],"names":["XVIZTableComponent","props","state","_formatData","nextProps","columns","nodes","setState","displayObjectId","map","col","name","display_text","type","rowIds","rows","forEach","node","row","data","column_values","children","id","parent","undefined","push","parentRow","console","log","title","description","width","height","style","renderHeader","renderCell","indentSize","Component","Table","TreeTable","PureComponent","PropTypes","oneOfType","string","number","object","func","stream","bool","array","column","value","String","getLogState","ownProps","frame","getCurrentFrame","streams","treetable"],"mappings":"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","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport React, {PureComponent} from 'react';\nimport {Table, TreeTable, Tooltip} from '@streetscape.gl/monochrome';\nimport PropTypes from 'prop-types';\n\nimport connectToLog from '../connect';\n\nclass XVIZTableComponent extends PureComponent {\n  static propTypes = {\n    // UI configuration\n    width: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    height: PropTypes.oneOfType([PropTypes.string, PropTypes.number]),\n    style: PropTypes.object,\n    renderHeader: PropTypes.func,\n    renderCell: PropTypes.func,\n    indentSize: PropTypes.number,\n\n    // From declarative UI table component\n    stream: PropTypes.string,\n    title: PropTypes.string,\n    description: PropTypes.string,\n    displayObjectId: PropTypes.bool,\n\n    // From connected log\n    columns: PropTypes.array,\n    nodes: PropTypes.array\n  };\n\n  static defaultProps = {\n    width: '100%',\n    height: 400,\n    style: {},\n    indentSize: 12,\n    renderHeader: ({column}) => column.name,\n    renderCell: ({value}) => (value === null ? null : String(value))\n  };\n\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      ...this._formatData(props)\n    };\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (nextProps.columns !== this.props.columns || nextProps.nodes !== this.props.nodes) {\n      this.setState(this._formatData(nextProps));\n    }\n  }\n\n  _formatData({columns, nodes, displayObjectId}) {\n    if (!columns || !nodes) {\n      return {columns: null};\n    }\n\n    columns = columns.map(col => ({\n      name: col.display_text,\n      type: col.type\n    }));\n\n    const rowIds = {};\n    const rows = [];\n\n    nodes.forEach(node => {\n      const row = {\n        data: node.column_values || [],\n        children: []\n      };\n      rowIds[node.id] = row;\n\n      if (node.parent === undefined) {\n        rows.push(row);\n      } else {\n        const parentRow = rowIds[node.parent];\n        if (parentRow) {\n          parentRow.children.push(row);\n        }\n      }\n    });\n\n    return {columns, rows};\n  }\n\n  render() {\n    console.log('JEFF: Hello from my fork');\n\n    const {columns, rows} = this.state;\n\n    if (!columns) {\n      // TODO - show loading message\n      return null;\n    }\n\n    const {\n      title,\n      description,\n      width,\n      height,\n      style,\n      renderHeader,\n      renderCell,\n      indentSize,\n      type\n    } = this.props;\n    const Component = type === 'table' ? Table : TreeTable;\n\n    return (\n      <div style={{width, height}}>\n        <Tooltip content={description}>\n          <h4>{title}</h4>\n        </Tooltip>\n        <Component\n          width=\"100%\"\n          height=\"100%\"\n          style={style}\n          renderHeader={renderHeader}\n          renderCell={renderCell}\n          indentSize={indentSize}\n          columns={columns}\n          rows={rows}\n        />\n      </div>\n    );\n  }\n}\n\nconst getLogState = (log, ownProps) => {\n  const frame = log.getCurrentFrame();\n  const data = frame && frame.streams[ownProps.stream];\n  return data && data.treetable;\n};\n\nexport default connectToLog({getLogState, Component: XVIZTableComponent});\n"],"file":"xviz-table.js"}