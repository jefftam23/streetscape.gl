{"version":3,"sources":["../../../src/loaders/xviz-loader-interface.js"],"names":["getXVIZConfig","StreamSynchronizer","LOG_STREAM_MESSAGE","clamp","createSelector","stats","XVIZLoaderInterface","constructor","options","message","type","METADATA","_onXVIZMetadata","emit","TIMESLICE","_onXVIZTimeslice","DONE","error","get","_getDataVersion","_getDataByStream","_getBufferedTimeRanges","getStreamSettings","_getStreams","streamSettings","streams","result","streamName","getCurrentTime","_getBufferStartTime","_getBufferEndTime","getMetadata","metadata","_getLogStartTime","_getLogEndTime","getLookAhead","timestamp","lookAhead","logSynchronizer","Number","isFinite","setTime","setLookAheadTimeOffset","getCurrentFrame","_updateTimer","listeners","forEach","o","_version","_debug","debug","callbacks","state","_updates","on","eventType","cb","push","off","index","indexOf","splice","eventArgs","incrementCount","subscribe","instance","unsubscribe","findIndex","key","set","value","requestAnimationFrame","_update","isOpen","connect","Error","seek","startTime","getLogStartTime","endTime","getLogEndTime","streamBuffer","setCurrentTime","setLookAhead","updateStreamSettings","settings","close","_bumpDataVersion","Object","keys","length","newTimestamp","start_time","timeslice","bufferUpdated","insert","range","getLoadedTimeRange","start","end","TIME_WINDOW","end_time"],"mappings":"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","sourcesContent":["// Copyright (c) 2019 Uber Technologies, Inc.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport {getXVIZConfig, StreamSynchronizer, LOG_STREAM_MESSAGE} from '@xviz/parser';\nimport {clamp} from 'math.gl';\n\nimport createSelector from '../utils/create-selector';\nimport stats from '../utils/stats';\n\n/* eslint-disable callback-return */\nexport default class XVIZLoaderInterface {\n  constructor(options = {}) {\n    this.options = options;\n    this._debug = options.debug || (() => {});\n    this.callbacks = {};\n\n    this.listeners = [];\n    this.state = {};\n    this._updates = 0;\n    this._version = 0;\n    this._updateTimer = null;\n  }\n\n  /* Event types:\n   * - ready\n   * - update\n   * - finish\n   * - error\n   */\n  on(eventType, cb) {\n    this.callbacks[eventType] = this.callbacks[eventType] || [];\n    this.callbacks[eventType].push(cb);\n    return this;\n  }\n\n  off(eventType, cb) {\n    const callbacks = this.callbacks[eventType];\n    if (callbacks) {\n      const index = callbacks.indexOf(cb);\n      if (index >= 0) {\n        callbacks.splice(index, 1);\n      }\n    }\n    return this;\n  }\n\n  emit(eventType, eventArgs) {\n    const callbacks = this.callbacks[eventType];\n    if (callbacks) {\n      for (const cb of callbacks) {\n        cb(eventType, eventArgs);\n      }\n    }\n    stats.get(`loader-${eventType}`).incrementCount();\n  }\n\n  subscribe(instance) {\n    this.listeners.push(instance);\n  }\n\n  unsubscribe(instance) {\n    const index = this.listeners.findIndex(o => o === instance);\n    if (index >= 0) {\n      this.listeners.splice(index, 1);\n    }\n  }\n\n  get(key) {\n    return this.state[key];\n  }\n\n  set(key, value) {\n    if (this.state[key] !== value) {\n      this.state[key] = value;\n      this._version++;\n      if (!this._updateTimer) {\n        /* global requestAnimationFrame */\n        this._updateTimer = requestAnimationFrame(this._update);\n      }\n    }\n  }\n\n  onXVIZMessage = message => {\n    switch (message.type) {\n      case LOG_STREAM_MESSAGE.METADATA:\n        this._onXVIZMetadata(message);\n        this.emit('ready', message);\n        break;\n\n      case LOG_STREAM_MESSAGE.TIMESLICE:\n        this._onXVIZTimeslice(message);\n        this.emit('update', message);\n        break;\n\n      case LOG_STREAM_MESSAGE.DONE:\n        this.emit('finish', message);\n        break;\n\n      default:\n        this.emit('error', message);\n    }\n  };\n\n  onError = error => {\n    this.emit('error', error);\n  };\n\n  /* Connection API */\n  isOpen() {\n    return false;\n  }\n\n  connect() {\n    throw new Error('not implemented');\n  }\n\n  seek(timestamp) {\n    const metadata = this.getMetadata();\n\n    if (metadata) {\n      const startTime = this.getLogStartTime();\n      const endTime = this.getLogEndTime();\n      if (Number.isFinite(startTime) && Number.isFinite(endTime)) {\n        timestamp = clamp(timestamp, startTime, endTime);\n      }\n    }\n\n    this.set('timestamp', timestamp);\n\n    // Notify the stream buffer of the current play head\n    // for any data management needs.\n    this.streamBuffer.setCurrentTime(timestamp);\n  }\n\n  setLookAhead(lookAhead) {\n    this.set('lookAhead', lookAhead);\n  }\n\n  updateStreamSettings(settings) {\n    const streamSettings = this.get('streamSettings');\n    this.set('streamSettings', {...streamSettings, ...settings});\n  }\n\n  close() {\n    throw new Error('not implemented');\n  }\n\n  /* Data selector API */\n\n  getCurrentTime = () => this.get('timestamp');\n\n  getLookAhead = () => this.get('lookAhead');\n\n  getMetadata = () => this.get('metadata');\n\n  getStreamSettings = () => this.get('streamSettings');\n\n  _getDataVersion = () => this.get('dataVersion');\n\n  _getStreams = createSelector(this, this._getDataVersion, () => this._getDataByStream());\n\n  getBufferedTimeRanges = createSelector(this, this._getDataVersion, () =>\n    this._getBufferedTimeRanges()\n  );\n\n  getStreams = createSelector(\n    this,\n    [this.getStreamSettings, this._getStreams, this._getDataVersion],\n    (streamSettings, streams) => {\n      if (!streamSettings || !streams) {\n        return streams;\n      }\n      const result = {};\n      for (const streamName in streams) {\n        if (streamSettings[streamName]) {\n          result[streamName] = streams[streamName];\n        }\n      }\n      return result;\n    }\n  );\n\n  getBufferStartTime = createSelector(this, this.getCurrentTime, () => this._getBufferStartTime());\n  getBufferEndTime = createSelector(this, this.getCurrentTime, () => this._getBufferEndTime());\n\n  getLogStartTime = createSelector(this, this.getMetadata, metadata =>\n    this._getLogStartTime(metadata)\n  );\n  getLogEndTime = createSelector(this, this.getMetadata, metadata => this._getLogEndTime(metadata));\n\n  getCurrentFrame = createSelector(\n    this,\n    [this.getStreamSettings, this.getCurrentTime, this.getLookAhead, this._getDataVersion],\n    // `dataVersion` is only needed to trigger recomputation.\n    // The logSynchronizer has access to the timeslices.\n    (streamSettings, timestamp, lookAhead) => {\n      const {logSynchronizer} = this;\n      if (logSynchronizer && Number.isFinite(timestamp)) {\n        logSynchronizer.setTime(timestamp);\n        logSynchronizer.setLookAheadTimeOffset(lookAhead);\n        return logSynchronizer.getCurrentFrame(streamSettings);\n      }\n      return null;\n    }\n  );\n\n  /* Private actions */\n  _update = () => {\n    this._updateTimer = null;\n    this.listeners.forEach(o => o(this._version));\n  };\n\n  _bumpDataVersion() {\n    this._updates++;\n    this.set('dataVersion', this._updates);\n  }\n\n  /* Subclass hooks */\n\n  _onXVIZMetadata(metadata) {\n    this.set('metadata', metadata);\n    if (metadata.streams && Object.keys(metadata.streams).length > 0) {\n      this.set('streamSettings', metadata.streams);\n    }\n\n    if (!this.streamBuffer) {\n      throw new Error('streamBuffer is missing');\n    }\n    this.logSynchronizer = this.logSynchronizer || new StreamSynchronizer(this.streamBuffer);\n\n    const timestamp = this.get('timestamp');\n    const newTimestamp = Number.isFinite(timestamp) ? timestamp : metadata.start_time;\n    if (Number.isFinite(newTimestamp)) {\n      this.seek(newTimestamp);\n    }\n  }\n\n  _onXVIZTimeslice(timeslice) {\n    const bufferUpdated = this.streamBuffer.insert(timeslice);\n    if (bufferUpdated) {\n      this._bumpDataVersion();\n    }\n    return bufferUpdated;\n  }\n\n  _getDataByStream() {\n    // XVIZStreamBuffer.getStreams filters out missing streams. This has significant impact\n    // on performance. Here we take the unfiltered slices and only filter them if a stream\n    // is used.\n\n    // return this.streamBuffer.getStreams();\n    return this.streamBuffer.streams;\n  }\n\n  _getBufferedTimeRanges() {\n    const range = this.streamBuffer.getLoadedTimeRange();\n    if (range) {\n      return [[range.start, range.end]];\n    }\n    return [];\n  }\n\n  _getLogStartTime(metadata) {\n    return metadata && metadata.start_time && metadata.start_time + getXVIZConfig().TIME_WINDOW;\n  }\n\n  _getLogEndTime(metadata) {\n    return metadata && metadata.end_time;\n  }\n\n  _getBufferStartTime() {\n    return this.getLogStartTime();\n  }\n\n  _getBufferEndTime() {\n    return this.getLogEndTime();\n  }\n}\n"],"file":"xviz-loader-interface.js"}